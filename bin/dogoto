#!/usr/bin/env node

var argv = require('optimist')
	.boolean('l', {
		alias: 'list'}).argv;

var fs = require('fs');
var homedir = process.env.HOME || process.env.HOMEPATH || process.env.USERPROFILE;
var markName=process.argv[2]||"default";
var markFile=homedir+"/.marked_destinations";
var markTest, markSet, findPattern, foundSet = [];


try {
	markSet = JSON.parse(fs.readFileSync(markFile, 'utf8'));
}catch(e){
	process.exit();
}

if(argv.l || argv.list){
	console.error(JSON.stringify(markSet, null, '\t'));
	process.stdout.write('.');
	process.exit();
}

if(markSet[markName]){
	process.stdout.write(markSet[markName]);
}else{
	findPattern = new RegExp(markName);
	for(markTest in markSet){
		if(findPattern.exec(markTest) && markTest != 'default'){
			process.stdout.write(markSet[markTest]);
			process.exit();
		}
	}
	console.error("no mark called "+markName+" found");
	process.stdout.write('.');
}
